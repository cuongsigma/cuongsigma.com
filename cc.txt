getgenv().SilentAim = true

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local function getClosestPlayer()
	local closestDistance = math.huge
	local target = nil

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
			local head = player.Character.Head
			local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(head.Position)
			if onScreen then
				local distance = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
				if distance < closestDistance then
					closestDistance = distance
					target = player
				end
			end
		end
	end

	return target
end

-- Hook
local mt = getrawmetatable(game)
local backup = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(...)
	local args = {...}
	local method = getnamecallmethod()
	if SilentAim and tostring(method) == "FireServer" and tostring(args[2]) == "UpdateMousePos" then
		local target = getClosestPlayer()
		if target and target.Character and target.Character:FindFirstChild("Head") then
			args[3] = target.Character.Head.Position + Vector3.new(0, 0.1, 0)
		end
		return backup(unpack(args))
	end
	return backup(...)
end)
